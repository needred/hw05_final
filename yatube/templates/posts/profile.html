{% extends 'base.html' %}
{% load thumbnail %}
{% block title %}
  Профайл пользователя {{ author.get_full_name }}
{% endblock %}
{% block content %}
  {% load posts_filters %} {# Загружаем фильтры #}
  <div class="row tm-row">
    <div class="col-12">
      <h1 class="tm-color-primary">Все посты пользователя {{ author.get_full_name }} <i class="fas fa-edit tm-color-primary"></i> {{ count }}</h1>
        {% if show_follow_button %}
          {% include 'posts/includes/follow_button.html' %}
        {% endif %}
    </div>
    <div class="col-12 tm-mb-15">
    <span class="tm-color-primary">
      {% if author.following.count > 0 %}
        Подписчики автора ({{ author.following.count }}):
        {% for follower in author.following.all %}
          <a class="tm-border" href="{% url 'post:profile' follower.user.username %}" title="Профиль пользователя {{ follower.user.get_full_name }}">
            {{ follower.user.get_full_name }}</a>
        {% endfor %}
      {% else %}
        Подписчиков пока нет
      {% endif %}</span>
      </div>
    <div class="col-12 tm-mb-40">
    <span class="tm-color-primary">
    {%  if author.follower.count > 0 %}
      На кого подписан автор ({{ author.follower.count }}):
      {% for following in author.follower.all %}
          <a class="tm-border" href="{% url 'post:profile' following.author.username %}" title="Профиль пользователя {{ following.author.get_full_name }}">
          {{ following.author.get_full_name }}</a>
      {% endfor %}
      {% else %}
        Автор ни на кого не подписан
      {% endif %}</span>
    </div>
  </div>
  <div class="row tm-row">

  {% for post in page_obj %}

    <article class="col-12 col-md-6 tm-post">
      <hr class="tm-hr-primary">
      <a href="{% url 'post:post_detail' post.id %}" class="effect-lily tm-post-link tm-pt-60">
        <div class="tm-post-link-inner">
          {% thumbnail post.image "960x339" crop="center" upscale=True as im %}
            <img class="img-fluid" src="{{ im.url }}">
          {% endthumbnail %}
        </div>
        {% if forloop.counter < 3 and post.pub_date|days_until < 3 and post.image %}<span class="position-absolute tm-new-badge">Новое</span>{% endif %}
      </a>
      <p class="tm-pt-30">{{ post.text|first_2paragraph|safe|linebreaksbr }}</p>
      <div class="form-group row text-right">
        <div class="col-12">
        <a class="tm-btn tm-btn-primary tm-btn-small"
          href="{% url 'post:post_detail' post.id %}" role="button">
          Подробнее
        </a>
        </div>
        </div>
        <div class="d-flex justify-content-between tm-pt-45">
          <span class="tm-color-primary">
          {% if post.group %}
            <a class="tm-color-primary" href="{% url 'post:group_list' post.group.slug %}">
              {{ post.group.title|truncatechars:35 }}
            </a>
          {% endif %}
          </span>
          <span class="tm-color-primary" title="Дата публикации">{{ post.pub_date|date:"d E Y" }}</span>
        </div>
        <hr>
        <div class="d-flex justify-content-between">
            <span title="Комментарии">
                {% if post.comments.count > 0 %}
                    <i class="fas fa-comments tm-color-primary"></i> {{ post.comments.count }}
                {% endif %}
            </span>
          <span></span>
        </div>
    </article>

  {% endfor %}
  </div>
  {% include 'posts/includes/paginator.html' %}
{% endblock %}